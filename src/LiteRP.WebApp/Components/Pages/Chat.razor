@page "/chat/new/{CharacterIdForNewChat:guid}"
@inject IChatSessionService ChatSessionService
@inject IToastService ToastService
@inject ICharacterService CharacterService
@inject ILogger<Chat> Logger
@inject NavigationManager Nav
@inject ISettingsService SettingsService

<PageTitle>LiteRP - Chat with @_character?.Name</PageTitle>

<div class="max-w-4xl mx-auto" style="max-width: 90ch;">
    
    <div id="chat-container" class="d-flex flex-column flex-grow-1 p-4 space-y-6 pb-32" style="overflow-y: auto;">
        @foreach (var message in _chatMessageViewModels)
        {
            <ChatMessageView ChatMessage="message" />
        }
    </div>

    <div class="fixed bottom-6 left-0 right-0 md:left-64 mx-auto max-w-[90ch] items-end gap-2">
        <div class="relative">
            <LrpInput TValue="string"
                      id="chat-input"
                      @bind-Value="_userInput"
                      Placeholder="Write a message.."
                      Lines="1"
                      MaxLines="20"
                      AutoGrow
                      Variant="LrpInputVariant.White"
                      InputClass="chat-input"/>
            @if (_isAiResponding)
            {
                <LrpButton Icon="IconTypes.StopSolid" Class="absolute bottom-3.5 right-3" OnClick="StopResponding"/>
            }
            else
            {
                <LrpButton Icon="IconTypes.PaperPlane" Class="absolute bottom-3.5 right-3" OnClick="SendMessage"/>
            }
        </div>
    </div>
</div>